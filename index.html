<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Financeiro Pro</title>
    <style>
        /* Mantive o CSS igual ao seu arquivo original */
    </style>
</head>
<body data-theme="dark">
    <div class="container">
        <!-- Sidebar + Main Content (igual ao seu HTML original) -->
    </div>

    <!-- Bibliotecas externas -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
    const state = {
        receitas: JSON.parse(localStorage.getItem('receitas')) || [],
        despesas: JSON.parse(localStorage.getItem('despesas')) || [],
        metas: JSON.parse(localStorage.getItem('metas')) || [],
        investimentos: JSON.parse(localStorage.getItem('investimentos')) || [],
        reservas: JSON.parse(localStorage.getItem('reservas')) || []
    };

    function salvarState() {
        for (let key in state) localStorage.setItem(key, JSON.stringify(state[key]));
    }

    // Navegação SPA
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', e => {
            e.preventDefault();
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            link.classList.add('active');
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(link.dataset.page).classList.add('active');
        });
    });

    // ======= Formulários =======
    function bindForm(id, tipo) {
        document.getElementById(id)?.addEventListener('submit', e => {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(e.target));
            state[tipo].push({ ...data, id: Date.now() });
            salvarState();
            e.target.reset();
            renderAll();
        });
    }

    bindForm('form-receita', 'receitas');
    bindForm('form-despesa', 'despesas');
    bindForm('form-meta', 'metas');
    bindForm('form-investimento', 'investimentos');
    bindForm('form-reserva', 'reservas');

    // ======= Renderizações =======
    function renderReceitas() {
        const tbody = document.getElementById('receitas-list');
        if (!tbody) return;
        tbody.innerHTML = state.receitas.map(r => `
            <tr>
                <td>${r.data}</td><td>${r.descricao}</td><td>${r.tipo}</td>
                <td>R$ ${parseFloat(r.valor).toFixed(2)}</td>
                <td>${r.fixo ? 'Sim' : 'Não'}</td>
                <td><button class="btn btn-danger" onclick="deletarItem('receitas', ${r.id})">Excluir</button></td>
            </tr>`).join('');
    }

    function renderDespesas() {
        const tbody = document.getElementById('despesas-list');
        if (!tbody) return;
        tbody.innerHTML = state.despesas.map(d => `
            <tr>
                <td>${d.data}</td><td>${d.descricao}</td><td>${d.categoria}</td>
                <td>R$ ${parseFloat(d.valor).toFixed(2)}</td>
                <td>${d.fixo ? 'Sim' : 'Não'}</td>
                <td><button class="btn btn-danger" onclick="deletarItem('despesas', ${d.id})">Excluir</button></td>
            </tr>`).join('');
    }

    function renderMetas() {
        const div = document.getElementById('metas-list');
        if (!div) return;
        div.innerHTML = state.metas.map(m => `<div class="card"><b>${m.descricao}</b> - R$ ${m.valorObjetivo} até ${m.prazo}</div>`).join('');
    }

    function renderInvestimentos() {
        const tbody = document.getElementById('investimentos-list');
        if (!tbody) return;
        tbody.innerHTML = state.investimentos.map(i => `
            <tr>
                <td>${i.nome}</td><td>${i.tipo}</td>
                <td>R$ ${parseFloat(i.valor).toFixed(2)}</td>
                <td>${i.data}</td>
                <td><button class="btn btn-danger" onclick="deletarItem('investimentos', ${i.id})">Excluir</button></td>
            </tr>`).join('');
    }

    function renderReservas() {
        const total = state.reservas.reduce((a, r) => a + parseFloat(r.valor), 0);
        document.getElementById('valor-reserva').textContent = `R$ ${total.toFixed(2)}`;
    }

    function deletarItem(tipo, id) {
        state[tipo] = state[tipo].filter(i => i.id !== id);
        salvarState();
        renderAll();
    }

    // ======= Dashboard =======
    function atualizarDashboard() {
        const totalR = state.receitas.reduce((a, r) => a + parseFloat(r.valor), 0);
        const totalD = state.despesas.reduce((a, d) => a + parseFloat(d.valor), 0);
        const saldo = totalR - totalD;
        document.getElementById('total-receitas').textContent = `R$ ${totalR.toFixed(2)}`;
        document.getElementById('total-despesas').textContent = `R$ ${totalD.toFixed(2)}`;
        document.getElementById('saldo-atual').textContent = `R$ ${saldo.toFixed(2)}`;
    }

    // ======= Balanço Mensal =======
    function gerarBalanco() {
        const mesAno = document.getElementById('mes-balanco').value;
        if (!mesAno) return;
        const [ano, mes] = mesAno.split('-');
        const receitasMes = state.receitas.filter(r => r.data.startsWith(`${ano}-${mes}`));
        const despesasMes = state.despesas.filter(d => d.data.startsWith(`${ano}-${mes}`));
        const totalR = receitasMes.reduce((a, r) => a + parseFloat(r.valor), 0);
        const totalD = despesasMes.reduce((a, d) => a + parseFloat(d.valor), 0);

        document.getElementById('balanco-receitas').textContent = `R$ ${totalR.toFixed(2)}`;
        document.getElementById('balanco-despesas').textContent = `R$ ${totalD.toFixed(2)}`;
        document.getElementById('balanco-resultado').textContent = `R$ ${(totalR-totalD).toFixed(2)}`;
        document.getElementById('balanco-content').style.display = 'block';

        new Chart(document.getElementById('receitasChart'), {
            type: 'pie',
            data: { labels: [...new Set(receitasMes.map(r => r.tipo))], datasets: [{ data: [...new Set(receitasMes.map(r => r.tipo))].map(t => receitasMes.filter(r => r.tipo===t).reduce((a,b)=>a+parseFloat(b.valor),0)) }] }
        });
        new Chart(document.getElementById('despesasChart'), {
            type: 'pie',
            data: { labels: [...new Set(despesasMes.map(d => d.categoria))], datasets: [{ data: [...new Set(despesasMes.map(d => d.categoria))].map(c => despesasMes.filter(d => d.categoria===c).reduce((a,b)=>a+parseFloat(b.valor),0)) }] }
        });

        document.getElementById('relatorio-detalhado').innerHTML = `
            <h4>Receitas</h4><ul>${receitasMes.map(r => `<li>${r.data} - ${r.descricao}: R$ ${r.valor}</li>`).join('')}</ul>
            <h4>Despesas</h4><ul>${despesasMes.map(d => `<li>${d.data} - ${d.descricao}: R$ ${d.valor}</li>`).join('')}</ul>`;
    }

    // ======= PDF =======
    function downloadPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text("Relatório Financeiro", 10, 10);
        doc.text(document.getElementById('relatorio-detalhado').innerText, 10, 20);
        doc.save("balanco.pdf");
    }

    // ======= Renderização Inicial =======
    function renderAll() {
        renderReceitas();
        renderDespesas();
        renderMetas();
        renderInvestimentos();
        renderReservas();
        atualizarDashboard();
    }
    renderAll();
    </script>
</body>
</html>
